<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>AI Concierge</title><style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;background:#f5f5f5;padding:20px}.container{max-width:900px;margin:0 auto}.card{background:white;padding:30px;border-radius:16px;margin-bottom:24px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}h1{font-size:36px;margin-bottom:8px}.subtitle{color:#666;font-size:18px}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}label{display:block;font-weight:600;margin-bottom:10px;color:#333;font-size:15px}input,select{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:10px;font-size:16px}input:focus,select:focus{outline:none;border-color:#000}.btn{width:100%;padding:18px;background:#000;color:white;border:none;border-radius:12px;font-size:18px;font-weight:700;cursor:pointer;margin-top:10px}.btn:hover{background:#333}.btn:disabled{background:#ccc;cursor:not-allowed}.restaurant{background:white;padding:28px;border-radius:16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.08);transition:all 0.2s}.restaurant:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.12)}.restaurant h3{margin:0 0 6px 0;font-size:24px}.cuisine{color:#999;font-size:15px;margin-bottom:16px}.badges{display:flex;gap:10px;flex-wrap:wrap;margin:16px 0;align-items:center}.badge{padding:8px 14px;border-radius:20px;font-size:14px;font-weight:600;border:2px solid #e0e0e0;background:#fafafa}.badge.distance{background:#e0f2fe;border-color:#7dd3fc;color:#075985}.hidden{display:none}.back-btn{padding:12px 24px;border:2px solid #ddd;border-radius:10px;background:white;cursor:pointer;font-weight:600;margin-bottom:24px;font-size:16px}.toggle-group{display:flex;gap:12px;margin-top:10px}.toggle-btn{flex:1;padding:14px;border:2px solid #e0e0e0;border-radius:10px;background:white;cursor:pointer;font-size:15px;font-weight:600;color:#333}.toggle-btn.active{background:#000;color:white;border-color:#000}.toggle-btn:hover{border-color:#000;background:#f5f5f5}.toggle-btn:hover.active{background:#000}.suggestion{background:#dbeafe;border:2px solid:#93c5fd;padding:20px;border-radius:12px;text-align:center}.suggestion h3{margin-bottom:12px;font-size:20px}.chatbot-btn{position:fixed;bottom:30px;right:30px;width:60px;height:60px;border-radius:50%;background:#000;color:white;border:none;font-size:28px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:1000;transition:all 0.2s}.chatbot-btn:hover{transform:scale(1.1);box-shadow:0 6px 20px rgba(0,0,0,0.4)}@media(max-width:768px){.form-row{grid-template-columns:1fr}.toggle-group{flex-direction:column}}.sort-bar{display:flex;align-items:center;gap:12px;margin-bottom:20px;padding:16px;background:#f9fafb;border-radius:12px}
</style></head><body>
<div class="container"><div class="card"><h1>ğŸ½ï¸ AI Concierge</h1><p class="subtitle">Find restaurants you can actually get into â€” ranked by real likelihood</p></div>
<div id="search" class="card">
<div style="margin-bottom:20px"><label>ğŸ“ Your Location</label><div style="display:flex;gap:10px"><input type="text" id="addressInput" placeholder="Enter address or use current location" style="flex:1"><button onclick="useCurrentLocation()" style="padding:14px 20px;border:2px solid #e0e0e0;border-radius:10px;background:white;cursor:pointer;font-weight:600;white-space:nowrap">ğŸ“ Use My Location</button></div><div id="locationInfo" style="margin-top:8px;color:#666;font-size:14px"></div></div>

<div style="margin-bottom:20px"><label>ğŸ“… Select Date</label><input type="date" id="dateInput" onchange="updateDateInfo()"><div id="dateInfo" style="margin-top:8px;color:#666;font-size:14px"></div></div>

<div style="margin-bottom:20px"><label>ğŸ• Preferred time slot</label><select id="timewindow"><option value="breakfast">Breakfast (8-10am)</option><option value="brunch">Brunch (10am-12pm)</option><option value="lunch">Lunch (12-2pm)</option><option value="afternoon">Afternoon (2-5pm)</option><option value="early">Early Dinner (5:30-6:30pm)</option><option value="prime" selected>Prime Dinner (7-8:30pm)</option><option value="late">Late Dinner (9pm+)</option></select></div>

<div class="form-row"><div><label>ğŸ‘¥ Party Size</label><input type="number" id="party" value="2" min="1" max="20"></div><div><label>ğŸ’° Budget per Person</label><select id="budget"><option value="0-999">No Price Preference</option><option value="1-50">$1 - $50</option><option value="50-75">$50 - $75</option><option value="80-100" selected>$80 - $100</option><option value="100-125">$100 - $125</option><option value="125-150">$125 - $150</option><option value="150-200">$150 - $200</option><option value="200-500">$200+</option></select></div></div>

<div style="margin-bottom:20px"><label>ğŸš— Transportation</label><div class="toggle-group"><button class="toggle-btn active" onclick="setTransport('walk')">ğŸš¶ Walk</button><button class="toggle-btn" onclick="setTransport('drive')">ğŸš— Drive</button><button class="toggle-btn" onclick="setTransport('transit')">ğŸš‡ Transit</button><button class="toggle-btn" onclick="setTransport('radius')">ğŸ“ Radius</button></div></div>

<div id="walkDistance" style="margin-bottom:20px"><label>ğŸš¶ Max Walk (minutes)</label><select id="walkTime"><option value="5">5 minutes</option><option value="10">10 minutes</option><option value="15">15 minutes</option><option value="20" selected>20 minutes</option><option value="25">25 minutes</option><option value="30">30 minutes</option></select></div>

<div id="driveDistance" style="margin-bottom:20px;display:none"><label>ğŸš— Max Drive Time (minutes)</label><select id="driveTime"><option value="5">5 minutes</option><option value="10">10 minutes</option><option value="15" selected>15 minutes</option><option value="20">20 minutes</option><option value="30">30 minutes</option><option value="45">45 minutes</option></select></div>

<div id="transitDistance" style="margin-bottom:20px;display:none"><label>ğŸš‡ Max Transit Time (minutes)</label><select id="transitTime"><option value="10">10 minutes</option><option value="15">15 minutes</option><option value="20" selected>20 minutes</option><option value="30">30 minutes</option><option value="45">45 minutes</option><option value="60">60 minutes</option></select></div>

<div id="radiusDistance" style="margin-bottom:20px;display:none"><label>ğŸ“ Radius (miles)</label><select id="radiusMiles"><option value="0.5">0.5 miles</option><option value="1">1 mile</option><option value="2">2 miles</option><option value="3" selected>3 miles</option><option value="5">5 miles</option><option value="10">10 miles</option></select></div>

<div style="margin-bottom:20px"><label>â­ Quality Level</label><select id="quality"><option value="any">Any Quality</option><option value="michelin_star">Michelin Star</option><option value="bib">Bib Gourmand</option><option value="michelin_recommended">Michelin Recommended</option><option value="five_star">5-Star Quality</option><option value="top_rated_and_above" selected>Top Rated & Above</option><option value="top_rated_only">Top Rated</option></select></div>

<div style="margin-bottom:20px"><label>ğŸ• Cuisine Type (optional)</label><select id="cuisine"><option value="any">Any Cuisine</option><option value="italian">Italian</option><option value="japanese">Japanese</option><option value="korean">Korean</option><option value="french">French</option><option value="american">American</option><option value="steakhouse">Steakhouse</option><option value="seafood">Seafood</option><option value="mexican">Mexican</option></select></div>

<button class="btn" onclick="search()" id="searchBtn">ğŸ” Find Available Tables</button>
</div>

<div id="results" class="hidden">
<button class="back-btn" onclick="back()">â† Edit Search</button>
<div id="warnings"></div>
<div class="sort-bar">
<label style="margin:0;font-weight:600">ğŸ“Š Sort by:</label>
<select id="sortBy" onchange="sortResults()">
<option value="quality">Quality (highest first)</option>
<option value="distance">Distance (closest first)</option>
<option value="price">Price (lowest first)</option>
</select>
</div>
<div id="list"></div>
</div>

<button class="chatbot-btn" onclick="openChat()">ğŸ’¬</button>
</div>

<script>
// QUALITY TIER CONFIGURATION
const QUALITY_CONFIG={
fiveStarQuality:{
googleRating:4.6,googleReviews:50,
yelpRating:4.6,yelpReviews:25
},
topRated:{
googleRatingMin:4.4,googleRatingMax:4.59,googleReviews:50,
yelpRatingMin:4.4,yelpRatingMax:4.59,yelpReviews:25
}
};

let state={transport:'walk',qualityFilter:'top_rated_and_above'};
let allRestaurants=[];

window.addEventListener('DOMContentLoaded',function(){
const today=new Date();
const tomorrow=new Date(today);
tomorrow.setDate(tomorrow.getDate()+1);
document.getElementById('dateInput').value=tomorrow.toISOString().split('T')[0];
document.getElementById('dateInput').min=today.toISOString().split('T')[0];
updateDateInfo();
document.getElementById('addressInput').value='New York, NY';
document.getElementById('locationInfo').textContent='ğŸ“ Searching near: New York, NY';
state.qualityFilter=document.getElementById('quality').value;
document.getElementById('quality').addEventListener('change',function(){
state.qualityFilter=this.value;
if(allRestaurants.length>0)sortResults();
});
});

function useCurrentLocation(){
if(navigator.geolocation){
document.getElementById('locationInfo').textContent='ğŸ“ Getting your location...';
navigator.geolocation.getCurrentPosition(
position=>{
const lat=position.coords.latitude;
const lon=position.coords.longitude;
document.getElementById('addressInput').value=`${lat},${lon}`;
document.getElementById('locationInfo').textContent='ğŸ“ Using your current location';
},
error=>{
document.getElementById('locationInfo').textContent='âš ï¸ Could not get location';
}
);
}
}

function updateDateInfo(){
const selectedDate=new Date(document.getElementById('dateInput').value);
const today=new Date();
today.setHours(0,0,0,0);
selectedDate.setHours(0,0,0,0);
const daysOut=Math.ceil((selectedDate-today)/(1000*60*60*24));
const dayName=selectedDate.toLocaleDateString('en-US',{weekday:'long'});
const dateStr=selectedDate.toLocaleDateString('en-US',{month:'long',day:'numeric'});
let info=`${dayName}, ${dateStr}`;
if(daysOut===0)info+=' (Today)';
else if(daysOut===1)info+=' (Tomorrow)';
else info+=` (${daysOut} days out)`;
document.getElementById('dateInfo').textContent=info;
}

function setTransport(mode){
state.transport=mode;
const parentDiv=event.target.parentElement;
parentDiv.querySelectorAll('.toggle-btn').forEach(b=>b.classList.remove('active'));
event.target.classList.add('active');
document.getElementById('walkDistance').style.display='none';
document.getElementById('driveDistance').style.display='none';
document.getElementById('transitDistance').style.display='none';
document.getElementById('radiusDistance').style.display='none';
if(mode=='walk')document.getElementById('walkDistance').style.display='block';
else if(mode=='drive')document.getElementById('driveDistance').style.display='block';
else if(mode=='transit')document.getElementById('transitDistance').style.display='block';
else document.getElementById('radiusDistance').style.display='block';
}

function openChat(){
alert('Chat coming soon!');
}

function calculateQualityTier(r){
if(r.michelinStars>=1)return{tier:'michelin_star',priority:1};
if(r.isBibGourmand)return{tier:'bib',priority:2};
if(r.isMichelinRecommended)return{tier:'michelin_recommended',priority:3};

const cfg=QUALITY_CONFIG.fiveStarQuality;
const googleQualifies=(r.googleRating>=cfg.googleRating&&r.googleReviewCount>=cfg.googleReviews);
const yelpQualifies=(r.yelpRating>=cfg.yelpRating&&r.yelpReviewCount>=cfg.yelpReviews);

if(googleQualifies||yelpQualifies)return{tier:'five_star',priority:4};

const cfgTop=QUALITY_CONFIG.topRated;
const googleTopRated=(r.googleRating>=cfgTop.googleRatingMin&&r.googleRating<=cfgTop.googleRatingMax&&r.googleReviewCount>=cfgTop.googleReviews);
const yelpTopRated=(r.yelpRating>=cfgTop.yelpRatingMin&&r.yelpRating<=cfgTop.yelpRatingMax&&r.yelpReviewCount>=cfgTop.yelpReviews);

if(googleTopRated||yelpTopRated)return{tier:'top_rated',priority:5};

return{tier:'none',priority:999};
}

function filterByQuality(restaurants){
const quality=state.qualityFilter;
if(quality==='any')return restaurants;

return restaurants.filter(r=>{
const tier=calculateQualityTier(r);
if(quality==='michelin_star')return tier.tier==='michelin_star';
if(quality==='bib')return tier.tier==='bib';
if(quality==='michelin_recommended')return tier.tier==='michelin_recommended';
if(quality==='five_star')return tier.priority<=4;
if(quality==='top_rated_and_above')return tier.priority<=5;
if(quality==='top_rated_only')return tier.tier==='top_rated';
return true;
});
}

async function search(){
const searchBtn=document.getElementById('searchBtn');
searchBtn.disabled=true;
searchBtn.textContent='ğŸ” Searching...';

const location=document.getElementById('addressInput').value;
const cuisine=document.getElementById('cuisine').value;
const timeSlot=document.getElementById('timewindow').value;
state.qualityFilter=document.getElementById('quality').value;
const openNow=(timeSlot=='prime'||timeSlot=='early'||timeSlot=='late');

let radius;
if(state.transport=='walk')radius=+document.getElementById('walkTime').value*80;
else if(state.transport=='drive')radius=+document.getElementById('driveTime').value*800;
else if(state.transport=='transit')radius=+document.getElementById('transitTime').value*800;
else radius=+document.getElementById('radiusMiles').value*1609;

try{
const response=await fetch('/.netlify/functions/search-restaurants',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({location,radius,cuisine:cuisine==='any'?undefined:cuisine,openNow})
});

if(!response.ok)throw new Error('Search failed');
const data=await response.json();

if(data.confirmedAddress){
document.getElementById('warnings').innerHTML=`<div style="background:#e0f2fe;border:2px solid #7dd3fc;padding:12px;border-radius:8px;margin-bottom:16px;color:#075985">ğŸ“ Searching near: ${data.confirmedAddress}</div>`;
}

allRestaurants=data.restaurants||[];
sortResults();

}catch(error){
console.error('Search error:',error);
document.getElementById('list').innerHTML='<div class="suggestion"><h3>ğŸ˜” Search failed</h3><p>Please try again.</p></div>';
}finally{
searchBtn.disabled=false;
searchBtn.textContent='ğŸ” Find Available Tables';
document.getElementById('search').classList.add('hidden');
document.getElementById('results').classList.remove('hidden');
window.scrollTo(0,0);
}
}

function sortResults(){
const sortBy=document.getElementById('sortBy').value;
let filtered=filterByQuality(allRestaurants);
let sorted=[...filtered];

if(sortBy==='quality'){
sorted.sort((a,b)=>calculateQualityTier(a).priority-calculateQualityTier(b).priority);
}else if(sortBy==='distance'){
sorted.sort((a,b)=>{
const aMin=Math.min(a.walkMinutes||999,a.driveMinutes||999,a.transitMinutes||999);
const bMin=Math.min(b.walkMinutes||999,b.driveMinutes||999,b.transitMinutes||999);
return aMin-bMin;
});
}else if(sortBy==='price'){
sorted.sort((a,b)=>(a.price_level||0)-(b.price_level||0));
}

displayResults(sorted);
}

function displayResults(restaurants){
if(restaurants.length===0){
document.getElementById('list').innerHTML='<div class="suggestion"><h3>ğŸ˜” No restaurants found</h3><p>Try adjusting your filters.</p></div>';
return;
}

let html=restaurants.map(r=>{
let distanceHtml='';
if(r.walkMinutes)distanceHtml+=`<span class="badge distance">ğŸš¶ ${r.walkMinutes} min</span>`;
if(r.driveMinutes)distanceHtml+=`<span class="badge distance">ğŸš— ${r.driveMinutes} min</span>`;
if(r.transitMinutes)distanceHtml+=`<span class="badge distance">ğŸš‡ ${r.transitMinutes} min</span>`;

return`
<div class="restaurant">
<h3>${r.name}</h3>
<div class="cuisine">${r.vicinity||r.formatted_address||''}</div>
<div class="badges">
<span class="badge">ğŸ’° ${r.price_level?'$'.repeat(r.price_level):'N/A'}</span>
${r.opening_hours?.open_now?'<span class="badge">âœ… Open Now</span>':''}
${distanceHtml}
<button onclick="book('${r.place_id}')" style="margin-left:auto;padding:8px 16px;background:#4285f4;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px">ğŸ“ Maps</button>
</div>
</div>
`;
}).join('');

document.getElementById('list').innerHTML=html;
}

function back(){
document.getElementById('search').classList.remove('hidden');
document.getElementById('results').classList.add('hidden');
}

function book(placeId){
window.open(`https://www.google.com/maps/search/?api=1&query=Google&query_place_id=${placeId}`,'_blank');
}
</script></body></html>
